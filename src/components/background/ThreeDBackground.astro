---
// 3D Moving Background Component using Three.js
---

<div id="three-d-background" class="fixed inset-0 -z-10 w-full h-full"></div>

<script>
  import * as THREE from 'three';

  const initializeThreeD = () => {
    const container = document.getElementById('three-d-background');
    if (!container) return;

    // Scene setup
    const scene = new THREE.Scene();
    scene.background = null;

    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.z = 30;

    const renderer = new THREE.WebGLRenderer({ 
      antialias: true, 
      alpha: true,
      powerPreference: 'high-performance'
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x000000, 0);
    container.appendChild(renderer.domElement);

    // Create animated geometries
    const geometries: THREE.BufferGeometry[] = [];
    const meshes: THREE.Mesh[] = [];

    // Create icosahedron
    const geo1 = new THREE.IcosahedronGeometry(8, 4);
    const material1 = new THREE.MeshPhongMaterial({
      color: 0x0066ff,
      emissive: 0x0033ff,
      wireframe: false,
      opacity: 0.7,
      transparent: true
    });
    const mesh1 = new THREE.Mesh(geo1, material1);
    mesh1.position.set(-20, 10, -30);
    scene.add(mesh1);
    meshes.push(mesh1);
    geometries.push(geo1);

    // Create torus
    const geo2 = new THREE.TorusGeometry(10, 3, 16, 100);
    const material2 = new THREE.MeshPhongMaterial({
      color: 0x6600ff,
      emissive: 0x4400ff,
      wireframe: false,
      opacity: 0.6,
      transparent: true
    });
    const mesh2 = new THREE.Mesh(geo2, material2);
    mesh2.position.set(25, -5, -30);
    mesh2.rotation.x = 0.5;
    scene.add(mesh2);
    meshes.push(mesh2);
    geometries.push(geo2);

    // Create octahedron
    const geo3 = new THREE.OctahedronGeometry(7, 2);
    const material3 = new THREE.MeshPhongMaterial({
      color: 0x00ccff,
      emissive: 0x0088ff,
      wireframe: false,
      opacity: 0.5,
      transparent: true
    });
    const mesh3 = new THREE.Mesh(geo3, material3);
    mesh3.position.set(0, -20, -40);
    scene.add(mesh3);
    meshes.push(mesh3);
    geometries.push(geo3);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);

    const pointLight1 = new THREE.PointLight(0x0066ff, 1, 200);
    pointLight1.position.set(20, 20, 20);
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0x6600ff, 0.8, 200);
    pointLight2.position.set(-30, -10, 20);
    scene.add(pointLight2);

    // Animation loop
    const animate = () => {
      requestAnimationFrame(animate);

      // Rotate and move meshes
      meshes[0].rotation.x += 0.0005;
      meshes[0].rotation.y += 0.0008;
      meshes[0].position.y += Math.sin(Date.now() * 0.0005) * 0.02;

      meshes[1].rotation.x += 0.0003;
      meshes[1].rotation.z += 0.0007;
      meshes[1].position.x += Math.cos(Date.now() * 0.0004) * 0.02;

      meshes[2].rotation.y += 0.0006;
      meshes[2].position.z += Math.sin(Date.now() * 0.0003) * 0.01;

      renderer.render(scene, camera);
    };

    animate();

    // Handle window resize
    const handleResize = () => {
      const width = window.innerWidth;
      const height = window.innerHeight;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    };

    window.addEventListener('resize', handleResize);

    // Cleanup function
    return () => {
      window.removeEventListener('resize', handleResize);
      geometries.forEach(geo => geo.dispose());
      renderer.dispose();
      container.removeChild(renderer.domElement);
    };
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeThreeD);
  } else {
    initializeThreeD();
  }
</script>

<style>
  #three-d-background {
    pointer-events: none;
  }
</style>
